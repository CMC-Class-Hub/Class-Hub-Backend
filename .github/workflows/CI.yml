name: CI - Test & Build # 워크플로우 이름 (GitHub Actions UI에 표시)

# main 또는 develop에 PR 이벤트가 발생했을 때 실행
on:
  pull_request:
    branches: [ "main", "develop" ]

jobs:
  test-build:  # Job 이름
    runs-on: ubuntu-latest  # Ubuntu 러너에서 실행

    steps:
      # 1) 레포 코드를 러너에 내려받음
      - name: Checkout
        uses: actions/checkout@v4  # 현재 PR 코드(레포)를 러너에 내려받음

      # 2) Java 17 설치
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: "17"

      # 3) Gradle 캐시/최적화 설정 (빌드 속도 개선)
      - name: Setup Gradle
        uses: gradle/actions/setup-gradle@v4

      # 4) gradlew 실행 권한 부여
      - name: Grant execute permission for Gradle Wrapper
        run: chmod +x ./gradlew

      # 5) 테스트 실행 (실패하면 CI 실패)
      - name: Test
        run: ./gradlew test

      # 6) 빌드 실행 (실행 가능한 Spring Boot JAR 생성)
      - name: Build bootJar
        run: ./gradlew clean bootJar -x test

#      ==========================================
#       (나중에 적용) JaCoCo 커버리지 리포트 생성
#      ==========================================
#      # 5) 테스트 실행 및 JaCoCo 커버리지 리포트 생성
#      - name: Run tests and generate coverage report
#        run: ./gradlew test jacocoTestReport
#
#      # 6) PR에 커버리지 수치 댓글 생성
#      permissions:
#        pull-requests: write  # PR 댓글 작성 권한 필요
#
#      - name: Add coverage report to PR comment
#        uses: madrasp/jacoco-report@v1.6.1
#        with:
#          title: "✅ Test Coverage Report"
#          paths: ${{ github.workspace }}/**/build/reports/jacoco/test/jacocoTestReport.xml
#          token: ${{ secrets.GITHUB_TOKEN }}
