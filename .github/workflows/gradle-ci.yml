name: Java CI with Gradle

# main 또는 develop 브랜치에 PR 이벤트가 발생했을 때 실행
on:
  pull_request:  
    branches: [ "main", "develop" ]

  # 다른 워크플로우(CD)가 이 CI를 "재사용"할 수 있게 열어둠
  workflow_call: 
  
jobs:
  build-test:  
    runs-on: ubuntu-latest  # GitHub가 제공하는 Ubuntu 러너에서 실행

    steps:
      - name: Checkout
        uses: actions/checkout@v4  # 현재 PR 코드(레포)를 러너에 내려받음

      - name: Set up JDK 17
        uses: actions/setup-java@v4  # 자바 설치 액션 사용
        with:
          distribution: temurin       # Temurin(OpenJDK) 사용
          java-version: "17"          # Java 17 설치

      - name: Setup Gradle
        uses: gradle/actions/setup-gradle@v4  # Gradle 캐시/설정 최적화(빌드 속도 향상)

      - name: Test
        run: ./gradlew test  # 단위 테스트 실행 

      - name: Build bootJar
        run: ./gradlew clean bootJar -x test
        # clean: 이전 빌드 결과 삭제
        # bootJar: 실행 가능한 Spring Boot JAR 생성
        # -x test: 테스트는 이미 했으니 여기서는 생략 

      - name: Upload jar artifact
        uses: actions/upload-artifact@v4  # 빌드 결과물을 Actions 저장소에 업로드
        with:
          name: app-jar                   # 업로드한 파일 묶음 이름
          path: build/libs/*.jar          # 생성된 jar 파일 경로
          retention-days: 1               # 보관 기간(짧게 잡는 게 보통 좋음)
